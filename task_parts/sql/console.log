root@containersgb:~# mysql -p
Enter password: 
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 13
Server version: 8.0.35 MySQL Community Server - GPL

Copyright (c) 2000, 2023, Oracle and/or its affiliates.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql> DROP DATABASE IF EXISTS `Human Friends`;
Query OK, 5 rows affected (1,39 sec)

mysql> CREATE DATABASE `Human Friends`;
Query OK, 1 row affected (0,14 sec)

mysql> USE `Human Friends`;
Database changed
mysql> 
mysql> -- Доступные комманды
mysql> DROP TABLE IF EXISTS available_commands;
Query OK, 0 rows affected, 1 warning (0,03 sec)

mysql> CREATE TABLE available_commands (
    ->   id SERIAL PRIMARY KEY,
    ->   name TEXT
    -> );
Query OK, 0 rows affected (0,58 sec)

mysql> 
mysql> INSERT INTO available_commands (id, name)
    -> VALUES
    -> (1, 'Sit'), (2, 'Stay'),
    -> (3, 'Fetch'), (4, 'Pounce'),
    -> (5, 'Roll'), (6, 'Hide'),
    -> (7, 'Paw'), (8, 'Voice'),
    -> (9, 'Scratch'), (10, 'Spin'),
    -> (11, 'Jump'), (12, 'Trot'),
    -> (13, 'Canter'), (14, 'Gallop'),
    -> (15, 'Walk'), (16, 'CarryLoad'),
    -> (17, 'Bray'), (18, 'Kick'),
    -> (19, 'Run');
Query OK, 19 rows affected (0,11 sec)
Records: 19  Duplicates: 0  Warnings: 0

mysql> 
mysql> -- Группы животных
mysql> DROP TABLE IF EXISTS animal_groups;
Query OK, 0 rows affected, 1 warning (0,10 sec)

mysql> CREATE TABLE animal_groups (
    ->   id SERIAL PRIMARY KEY,
    ->   name TEXT
    -> );
Query OK, 0 rows affected (0,47 sec)

mysql> 
mysql> INSERT INTO animal_groups (id, name)
    -> VALUES (1, 'Pets'), (2, 'Pack animals');
Query OK, 2 rows affected (0,07 sec)
Records: 2  Duplicates: 0  Warnings: 0

mysql> 
mysql> -- Типы животных
mysql> DROP TABLE IF EXISTS animal_types;
Query OK, 0 rows affected, 1 warning (0,05 sec)

mysql> CREATE TABLE animal_types (
    ->   id SERIAL PRIMARY KEY,
    ->   name TEXT,
    ->   animal_group_id BIGINT UNSIGNED NOT NULL,
    ->   FOREIGN KEY (animal_group_id) REFERENCES animal_groups(id) ON UPDATE CASCADE ON DELETE CASCADE
    -> );
Query OK, 0 rows affected (0,75 sec)

mysql> 
mysql> INSERT INTO animal_types (id, name, animal_group_id) VALUES
    -> (1, 'Cat', 1), (2, 'Dog', 1),
    -> (3, 'Hamster', 1), (4, 'Horse', 2),
    -> (5, 'Camel', 2), (6, 'Donkey', 2);
Query OK, 6 rows affected (0,08 sec)
Records: 6  Duplicates: 0  Warnings: 0

mysql> 
mysql> -- Животные
mysql> DROP TABLE IF EXISTS animals;
Query OK, 0 rows affected, 1 warning (0,11 sec)

mysql> CREATE TABLE animals (
    ->   id SERIAL PRIMARY KEY,
    ->   name TEXT,
    ->   birthdate DATE,
    ->   animal_type_id BIGINT UNSIGNED NOT NULL,
    ->   FOREIGN KEY (animal_type_id) REFERENCES animal_types(id) ON UPDATE CASCADE ON DELETE CASCADE
    -> );
Query OK, 0 rows affected (1,14 sec)

mysql> 
mysql> INSERT INTO animals (id, name, birthdate, animal_type_id) VALUES
    -> (1, 'Fido', '2020-01-01', 2), (2, 'Whiskers', '2019-05-15', 1),
    -> (3, 'Hammy', '2021-03-10', 3), (4, 'Buddy', '2018-12-10', 2),
    -> (5, 'Smudge', '2020-02-20', 1), (6, 'Peanut', '2021-08-01', 3),
    -> (7, 'Bella', '2019-11-11', 2), (8, 'Oliver', '2020-06-30', 1),
    -> (9, 'Thunder', '2015-07-21', 4), (10, 'Sandy', '2016-11-03', 5),
    -> (11, 'Eeyore', '2017-09-18', 6), (12, 'Storm', '2014-05-05', 4),
    -> (13, 'Dune', '2018-12-12', 5), (14, 'Burro', '2019-01-23', 6),
    -> (15, 'Blaze', '2016-02-29', 4), (16, 'Sahara', '2015-08-14', 5);
Query OK, 16 rows affected (0,10 sec)
Records: 16  Duplicates: 0  Warnings: 0

mysql> 
mysql> -- Комманды, которые умеют животные
mysql> DROP TABLE IF EXISTS commands;
Query OK, 0 rows affected, 1 warning (0,06 sec)

mysql> CREATE TABLE commands (
    -> --  id SERIAL PRIMARY KEY,
    ->   animal_id BIGINT UNSIGNED NOT NULL,
    ->   command_id BIGINT UNSIGNED NOT NULL,
    ->   FOREIGN KEY (animal_id) REFERENCES animals(id) ON UPDATE CASCADE ON DELETE CASCADE,
    ->   FOREIGN KEY (command_id) REFERENCES available_commands(id) ON UPDATE CASCADE ON DELETE CASCADE
    -> );
Query OK, 0 rows affected (1,11 sec)

mysql> 
mysql> INSERT INTO commands (animal_id, command_id) VALUES
    -> (1, 1), (1, 2), (1, 3), (2, 1), (2, 4), (3, 5),
    -> (3, 6), (4, 1), (4, 7), (4, 8), (5, 1), (5, 4),
    -> (5, 9), (6, 5), (6, 10), (7, 1), (7, 2), (7, 5),
    -> (8, 8), (8, 9), (8, 11), (9, 12), (9, 13), (9, 14),
    -> (10, 15), (10, 16), (11, 15), (11, 16), (11, 17), (12, 12),
    -> (12, 13), (13, 15), (13, 1), (14, 15), (14, 17), (14, 18),
    -> (15, 12), (15, 11), (15, 14), (16, 15), (16, 19);
Query OK, 41 rows affected (0,17 sec)
Records: 41  Duplicates: 0  Warnings: 0

mysql> -- Удалить записи о верблюдах и объединить таблицы лошадей и ослов.
mysql> 
mysql> -- Удаляю всех, кто 'Camel'
mysql> -- SELECT * FROM animals
mysql> DELETE FROM animals
    -> WHERE animal_type_id=(SELECT id FROM animal_types WHERE name='Camel');
Query OK, 3 rows affected (0,22 sec)

mysql> 
mysql> -- У меня нет отдельных таблиц под разные типы животных, я могу просто
mysql> SELECT id, name FROM animals
    -> WHERE animal_type_id IN (SELECT id FROM animal_types
    ->                          WHERE name='Horse' OR name='Donkey');
+----+---------+
| id | name    |
+----+---------+
|  9 | Thunder |
| 12 | Storm   |
| 15 | Blaze   |
| 11 | Eeyore  |
| 14 | Burro   |
+----+---------+
5 rows in set (0,00 sec)

mysql> 
mysql> -- Но задача стоит "объединить", значит будет
mysql> SELECT id, name FROM animals
    -> WHERE animal_type_id=(SELECT id FROM animal_types WHERE name='Horse')
    -> UNION
    -> SELECT id, name FROM animals
    -> WHERE animal_type_id=(SELECT id FROM animal_types WHERE name='Donkey');
+----+---------+
| id | name    |
+----+---------+
|  9 | Thunder |
| 12 | Storm   |
| 15 | Blaze   |
| 11 | Eeyore  |
| 14 | Burro   |
+----+---------+
5 rows in set (0,00 sec)

mysql> 
mysql> -- Создать новую таблицу для животных в возрасте от 1 до 3 лет и
mysql> --   вычислить их возраст с точностью до месяца.
mysql> 
mysql> --  Сделаю view, т.к. кажется, что он лучше подходит под задачу
mysql> CREATE OR REPLACE VIEW aged_animals AS
    -> SELECT name, birthdate FROM animals a
    -> -- с точностью до месяца это получить разницу с текущкй датой в месяцах и взять тех, кто попал в диапазон [12 ... 36]
    -> WHERE Timestampdiff(MONTH, a.birthdate, Curdate()) BETWEEN 12 AND 36;
Query OK, 0 rows affected (0,18 sec)

mysql> 
mysql> SELECT * FROM aged_animals;
+--------+------------+
| name   | birthdate  |
+--------+------------+
| Hammy  | 2021-03-10 |
| Peanut | 2021-08-01 |
+--------+------------+
2 rows in set (0,00 sec)

mysql> 
mysql> -- Объединить все созданные таблицы в одну, сохраняя
mysql> --   информацию о принадлежности к исходным таблицам
mysql> 
mysql> --  Вероятно имелось в виду собрать "красивую таблицу" как в постановке задачи, но для всех животных
mysql> --  Также VIEW тут наверное предпочтительнее, использую его
mysql> CREATE OR REPLACE VIEW fancy_all_animals AS
    -> SELECT
    ->   a.name AS 'name',
    ->   a.birthdate,
    ->   atp.name AS 'type',
    ->   agr.name AS 'group',
    ->   GROUP_CONCAT(ac.name SEPARATOR ',') AS 'commands'
    -> FROM animal_groups agr
    -> JOIN animal_types atp ON agr.id = atp.animal_group_id
    -> JOIN animals a ON a.animal_type_id = atp.id
    -> JOIN commands c ON c.animal_id = a.id
    -> JOIN available_commands ac on c.command_id = ac.id
    -> GROUP BY a.id;
Query OK, 0 rows affected (0,14 sec)

mysql> 
mysql> SELECT * FROM fancy_all_animals;
+----------+------------+---------+--------------+---------------------+
| name     | birthdate  | type    | group        | commands            |
+----------+------------+---------+--------------+---------------------+
| Fido     | 2020-01-01 | Dog     | Pets         | Fetch,Stay,Sit      |
| Whiskers | 2019-05-15 | Cat     | Pets         | Pounce,Sit          |
| Hammy    | 2021-03-10 | Hamster | Pets         | Roll,Hide           |
| Buddy    | 2018-12-10 | Dog     | Pets         | Sit,Paw,Voice       |
| Smudge   | 2020-02-20 | Cat     | Pets         | Scratch,Pounce,Sit  |
| Peanut   | 2021-08-01 | Hamster | Pets         | Roll,Spin           |
| Bella    | 2019-11-11 | Dog     | Pets         | Sit,Stay,Roll       |
| Oliver   | 2020-06-30 | Cat     | Pets         | Scratch,Voice,Jump  |
| Thunder  | 2015-07-21 | Horse   | Pack animals | Trot,Gallop,Canter  |
| Eeyore   | 2017-09-18 | Donkey  | Pack animals | Walk,CarryLoad,Bray |
| Storm    | 2014-05-05 | Horse   | Pack animals | Trot,Canter         |
| Burro    | 2019-01-23 | Donkey  | Pack animals | Walk,Bray,Kick      |
| Blaze    | 2016-02-29 | Horse   | Pack animals | Trot,Jump,Gallop    |
+----------+------------+---------+--------------+---------------------+
13 rows in set (0,00 sec)

mysql> 
